#!/bin/sh

clear
export MIX_ENV="${MIX_ENV:-dev}"


case "${0}" in

    # NOTE: Accept first param as MIX_ENV,
    #       Only if invoked from "bin/build" or "bin/console.
    "bin/build"|"bin/console")
        if [ -n "${1}" ]; then
            export MIX_ENV="${1:-${MIX_ENV}}"
            printf "%s\n" "Environment set: ${MIX_ENV}"
        fi
        ;;

    "bin/run")
        export MIX_ENV="${1:-prod}"
        printf "%s\n" "Environment set: ${MIX_ENV}"
        ;;

    "bin/test")
        export MIX_ENV="${1:-test}"
        printf "%s\n" "Environment set: ${MIX_ENV}"
        ;;

    *)
        printf "%s\n" "Environment: ${MIX_ENV}"
        ;;

esac

if [ ! -d "./deps/hound/lib" ]; then
    printf "%s\n" "Fetching deps.."
    eval "mix do deps.get, deps.compile"
fi

. ./.env


